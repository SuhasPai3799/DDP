// check if we have input from the user
check_input:
if (! getUserFeedback()) return;

// **********************************************************************
// INTRODUCTION
// **********************************************************************

check_salutation:
if (myLastDA() <= #Salutation(Meeting)) {
  if (activity <= Introduction) {
    myDA = myLastDA();
    // let's assume i was greeted back in the same way
    da = addLastDA(myDA);
  } else {
    logger.warn("salutation outside intro");
  }
  return;
}

check_liking:
if (myLastDA() <= #Request(Liking)) {
  if (activity <= Introduction) {
    String th = myLastDA().theme;
    // TODO: WHAT'S THIS? it's the text coming from the user (chunks[1]),
    // see InterpretationHandler.java
    String val = getUserFeedback();
    da = addLastDA(#Inform(Liking, theme=^th, value=^val));
    setLiking(user, th, val);
  } else {
    logger.warn("liking request outside intro");
  }
  userFeedbackProcessed();
  return;
}

check_age:
if (myLastDA() <= #Request(Name)) {
  if (activity <= Introduction) {
    String val = getUserFeedback();
    da = addLastDA(#Inform(Name, value=^val));
    user.forename = val;
  } else {
    logger.warn("name request outside intro");
  }
  userFeedbackProcessed();
  return;
}

// **********************************************************************
// Specialize Confirm
// **********************************************************************

request_answer:
if (myLastDA() <= #Request(top)) {
  replyType = "Request";
  switch (getUserFeedback().toLowerCase()) {
  case "yes":
    replyType = "AcceptRequest";
    break;
  case "no":
    replyType = "RejectRequest";
    break;
  }
  if (replyType == "Request") {
    DialogueAct reply = myLastDA().copy();
    reply.setDialogueAct(replyType);
    addLastDA(reply);
  }
  userFeedbackProcessed();
}

